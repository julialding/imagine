import sys
import os
import  tkinter as tk
import tkinter.messagebox as tk1
import tkinter.filedialog
from pathlib import Path
import time
from pathlib import Path
import numpy as np
import pandas as pd
import torch
import clip
from PIL import Image
from IPython.display import Image
from IPython.core.display import HTML

# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage


OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = os.path.join(OUTPUT_PATH, "assets/frame3")

print(OUTPUT_PATH.parent)
sys.path.append(OUTPUT_PATH.parent)

from database_handler import runRAG, getTopRow


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)

def search():
    # run DB access code here  "people in danger near fire"
    text = entry_4.get()
    # save text to txt file

    while not runRAG():
        time.sleep(.2)
        
    id, latitude, logitude, timestamp, sig, output = getTopRow()
    entry_3.delete(0, tk.END)
    entry_3.insert(0, "{id}: {output}")
    entry_2.delete(0, tk.END)
    entry_2.insert(0, latitude)
    entry_1.delete(0, tk.END)
    entry_1.insert(0, logitude)

def run_gui():
    gui_path = os.path.join(OUTPUT_PATH, "gui.py")
    print(gui_path)
    os.system(f'python "{gui_path}"')
    window.destroy()
    exit()

def done():
    # run_gui()
    window.destroy()
    exit()


window = Tk()
window.title("Natural Disasters Response System")
logo = tk.PhotoImage(file=os.path.join(ASSETS_PATH, "iconbitmap.gif"))
window.call('wm', 'iconphoto', window._w, logo)
window.geometry("862x519")
window.configure(bg = "#DDD3BA")


canvas = Canvas(
    window,
    bg = "#DDD3BA",
    height = 519,
    width = 862,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)
canvas.create_rectangle(
    431.0,
    0.0,
    862.0,
    519.0,
    fill="#FCFCFC",
    outline="")

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=done,
    relief="flat"
)
button_1.place(
    x=557.0,
    y=401.0,
    width=180.0,
    height=55.0
)

button_image_2 = PhotoImage(
    file=relative_to_assets("button_2.png"))
button_2 = Button(
    image=button_image_2,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: print("button_2 clicked"),
    relief="flat"
)
button_2.place(
    x=123.0,
    y=401.0,
    width=180.0,
    height=55.0
)

button_image_3 = PhotoImage(
    file=relative_to_assets("button_3.png"))
button_3 = Button(
    image=button_image_3,
    borderwidth=0,
    highlightthickness=0,
    command=search,
    relief="flat"
)
button_3.place(
    x=123.0,
    y=401.0,
    width=180.0,
    height=55.0
)

canvas.create_text(
    105.0,
    74.0,
    anchor="nw",
    text="Search the database!",
    fill="#5C4E3D",
    font=("Roboto Bold", 24 * -1)
)

canvas.create_text(
    482.0,
    74.0,
    anchor="nw",
    text="Images",
    fill="#505485",
    font=("Roboto Bold", 24 * -1)
)

entry_image_1 = PhotoImage(
    file=relative_to_assets("entry_1.png"))
entry_bg_1 = canvas.create_image(
    684.5,
    180.5,
    image=entry_image_1
)
entry_1 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_1.place(
    x=602.0,
    y=154.0,
    width=165.0,
    height=51.0
)

entry_image_2 = PhotoImage(
    file=relative_to_assets("entry_2.png"))
entry_bg_2 = canvas.create_image(
    684.5,
    251.5,
    image=entry_image_2
)
entry_2 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_2.place(
    x=602.0,
    y=225.0,
    width=165.0,
    height=51.0
)

entry_image_3 = PhotoImage(
    file=relative_to_assets("entry_3.png"))
entry_bg_3 = canvas.create_image(
    684.5,
    322.5,
    image=entry_image_3
)
entry_3 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_3.place(
    x=602.0,
    y=296.0,
    width=165.0,
    height=51.0
)

canvas.create_text(
    40.0,
    148.0,
    anchor="nw",
    text="Enter description here:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 20 * -1)
)

canvas.create_text(
    476.0,
    168.0,
    anchor="nw",
    text="Latitude:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

canvas.create_text(
    476.0,
    241.0,
    anchor="nw",
    text="Longitude:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

canvas.create_text(
    476.0,
    307.0,
    anchor="nw",
    text="Text:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

canvas.create_text(
    40.0,
    325.0,
    anchor="nw",
    text="Ex. fires, people, disaster (generic search)",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

canvas.create_text(
    476.0,
    114.0,
    anchor="nw",
    text="Location of most significant image",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

canvas.create_text(
    476.0,
    365.0,
    anchor="nw",
    text="All related images and details saved locally",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

entry_image_4 = PhotoImage(
    file=relative_to_assets("entry_4.png"))
entry_bg_4 = canvas.create_image(
    212.5,
    218.5,
    image=entry_image_4
)
entry_4 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_4.place(
    x=52.0,
    y=188.0,
    width=321.0,
    height=59.0
)
window.resizable(False, False)
window.mainloop()
