import sys
import os
import  tkinter as tk
import tkinter.messagebox as tk1
import tkinter.filedialog
from pathlib import Path
import tkinter as tk
from tkinter import filedialog
from PIL import Image
import cv2


# This file was generated by the Tkinter Designer by Parth Jadhav
# https://github.com/ParthJadhav/Tkinter-Designer


from pathlib import Path

# from tkinter import *
# Explicit imports to satisfy Flake8
from tkinter import Tk, Canvas, Entry, Text, Button, PhotoImage


OUTPUT_PATH = Path(__file__).parent
ASSETS_PATH = os.path.join(OUTPUT_PATH, "assets/frame2")


def relative_to_assets(path: str) -> Path:
    return ASSETS_PATH / Path(path)


window = Tk()
window.title("Natural Disasters Response System")
logo = tk.PhotoImage(file=os.path.join(ASSETS_PATH, "iconbitmap.gif"))
window.call('wm', 'iconphoto', window._w, logo)
window.geometry("862x519")
window.configure(bg = "#DDD3BA")

global output_path

image_uploaded = False

latitude = None
longitude = None
timestamp = None

def select_path():
    f_types = [('Image Files', ('*.jpg', '*.jpeg', '*.png')), ('All Files', '*.*')]
    output_path = filedialog.askopenfilename(filetypes=f_types)
    path_entry.delete(0, tk.END)
    path_entry.insert(0, output_path)

def take_snapshot():
    cap = cv2.VideoCapture(0)
    ret, frame = cap.read()
    path = os.path.join(OUTPUT_PATH.parent,"temp/snapshot.jpg")
    cv2.imwrite(str(path), frame)
    global output_path
    output_path = path
    cap.release()
    path_entry.delete(0, tk.END)
    path_entry.insert(0, "Snapshot taken!")

def upload_image():
    img = Image.open(output_path)
    global latitude, longitude, timestamp
    latitude = entry_1.get()
    longitude = entry_2.get()
    timestamp = entry_3.get()
    path = os.path.join(OUTPUT_PATH.parent,"temp/local_image.png")
    img.save(path)
    path_entry.delete(0, tk.END)
    path_entry.insert(0, "Saved! Please close all windows to continue.")
    global image_uploaded
    image_uploaded = True

def image_uploaded_check():
    return image_uploaded

def reset_image_uploaded():
    global image_uploaded
    image_uploaded = False

def image_details():
    return(latitude, longitude, timestamp)

canvas = Canvas(
    window,
    bg = "#DDD3BA",
    height = 519,
    width = 862,
    bd = 0,
    highlightthickness = 0,
    relief = "ridge"
)

canvas.place(x = 0, y = 0)
canvas.create_rectangle(
    431.0,
    0.0,
    862.0,
    519.0,
    fill="#FCFCFC",
    outline="")

button_image_1 = PhotoImage(
    file=relative_to_assets("button_1.png"))
button_1 = Button(
    image=button_image_1,
    borderwidth=0,
    highlightthickness=0,
    command=upload_image,
    relief="flat"
)
button_1.place(
    x=557.0,
    y=401.0,
    width=180.0,
    height=55.0
)

button_image_2 = PhotoImage(
    file=relative_to_assets("button_2.png"))
button_2 = Button(
    image=button_image_2,
    borderwidth=0,
    highlightthickness=0,
    command=lambda: print("button_2 clicked"),
    relief="flat"
)
button_2.place(
    x=123.0,
    y=401.0,
    width=180.0,
    height=55.0
)

button_image_3 = PhotoImage(
    file=relative_to_assets("button_3.png"))
button_3 = Button(
    image=button_image_3,
    borderwidth=0,
    highlightthickness=0,
    command=take_snapshot,
    relief="flat"
)
button_3.place(
    x=123.0,
    y=401.0,
    width=180.0,
    height=55.0
)

canvas.create_text(
    105.0,
    74.0,
    anchor="nw",
    text="Add a diaster image ",
    fill="#5C4E3D",
    font=("Roboto Bold", 24 * -1)
)

canvas.create_text(
    482.0,
    74.0,
    anchor="nw",
    text="Enter the details.",
    fill="#505485",
    font=("Roboto Bold", 24 * -1)
)

entry_image_1 = PhotoImage(
    file=relative_to_assets("entry_1.png"))
entry_bg_1 = canvas.create_image(
    715.0,
    167.5,
    image=entry_image_1
)
entry_1 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_1.place(
    x=619.0,
    y=137.0,
    width=192.0,
    height=59.0
)

entry_image_2 = PhotoImage(
    file=relative_to_assets("entry_2.png"))
entry_bg_2 = canvas.create_image(
    715.0,
    248.5,
    image=entry_image_2
)
entry_2 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_2.place(
    x=619.0,
    y=218.0,
    width=192.0,
    height=59.0
)

entry_image_3 = PhotoImage(
    file=relative_to_assets("entry_3.png"))
entry_bg_3 = canvas.create_image(
    715.0,
    329.5,
    image=entry_image_3
)
entry_3 = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
entry_3.place(
    x=619.0,
    y=299.0,
    width=192.0,
    height=59.0
)

canvas.create_text(
    40.0,
    148.0,
    anchor="nw",
    text="Upload a local image",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 20 * -1)
)

canvas.create_text(
    477.0,
    153.0,
    anchor="nw",
    text="Latitude:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 20 * -1)
)

canvas.create_text(
    477.0,
    236.0,
    anchor="nw",
    text="Longitude:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 20 * -1)
)

canvas.create_text(
    477.0,
    312.0,
    anchor="nw",
    text="Timestamp:",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 20 * -1)
)

canvas.create_text(
    40.0,
    325.0,
    anchor="nw",
    text="Or, take a snapshot of a connected camera",
    fill="#5C4E3D",
    font=("LibreBaskerville Regular", 16 * -1)
)

entry_image_4 = PhotoImage(
    file=relative_to_assets("entry_4.png"))
entry_bg_4 = canvas.create_image(
    212.5,
    218.5,
    image=entry_image_4
)
path_entry = Entry(
    bd=0,
    bg="#F1F5FF",
    fg="#000716",
    highlightthickness=0
)
path_entry.place(
    x=52.0,
    y=188.0,
    width=321.0,
    height=59.0
)

button_image_4 = PhotoImage(
    file=relative_to_assets("button_4.png"))
button_4 = Button(
    image=button_image_4,
    borderwidth=0,
    highlightthickness=0,
    command=select_path,
    relief="flat"
)
button_4.place(
    x=345.0,
    y=207.0,
    width=24.0,
    height=22.0
)
window.resizable(False, False)
window.mainloop()
